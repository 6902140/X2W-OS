\hypertarget{trapframe_8h}{}\doxysection{/home/data/proj/oskernel2023-\/x2w/include/trap/trapframe.h 文件参考}
\label{trapframe_8h}\index{/home/data/proj/oskernel2023-\/x2w/include/trap/trapframe.h@{/home/data/proj/oskernel2023-\/x2w/include/trap/trapframe.h}}


{\ttfamily \mbox{\hyperlink{trapframe_8h}{trapframe.\+h}}}中定义了通用的陷入帧{\ttfamily gtrapframe\+\_\+t}  


{\ttfamily \#include \char`\"{}types.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}constrains.\+h\char`\"{}}\newline
\doxysubsection*{类}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{struct____gtrapframe__t}{\+\_\+\+\_\+gtrapframe\+\_\+t}}
\begin{DoxyCompactList}\small\item\em {\ttfamily gtrapframe\+\_\+t}是通用陷入帧(\+General Trap Frame), 主要用于陷入中断/异常保存通用寄存器, 以方便在退出中断/异常的时候恢复现场 \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{struct____strapframe__t}{\+\_\+\+\_\+strapframe\+\_\+t}}
\begin{DoxyCompactList}\small\item\em {\ttfamily strapframe\+\_\+t}是{\ttfamily S\+BI}陷入帧(\+S\+B\+I Trap Frame), 在保存通用寄存器的基础上, 额外保存了{\ttfamily empc}寄存器和{\ttfamily mstatus}寄存器 \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{struct____ktrapframe__t}{\+\_\+\+\_\+ktrapframe\+\_\+t}}
\begin{DoxyCompactList}\small\item\em {\ttfamily ktrapframe\+\_\+t}是{\ttfamily Kernel}陷入帧(\+Kernel Trap Frame), 在保存通用寄存器的基础上, 额外保存了{\ttfamily sepc}, {\ttfamily sstatus}, {\ttfamily sbadaddr}, {\ttfamily scause}等寄存器 \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{类型定义}
\begin{DoxyCompactItemize}
\item 
typedef struct \mbox{\hyperlink{struct____gtrapframe__t}{\+\_\+\+\_\+gtrapframe\+\_\+t}} \mbox{\hyperlink{trapframe_8h_ac7135428295a151a70d7b6de6ae41a3d}{gtrapframe\+\_\+t}}
\begin{DoxyCompactList}\small\item\em {\ttfamily gtrapframe\+\_\+t}是通用陷入帧(\+General Trap Frame), 主要用于陷入中断/异常保存通用寄存器, 以方便在退出中断/异常的时候恢复现场 \end{DoxyCompactList}\item 
\mbox{\Hypertarget{trapframe_8h_ace23faaa1579bcc09327b838e4f18145}\label{trapframe_8h_ace23faaa1579bcc09327b838e4f18145}} 
typedef struct \mbox{\hyperlink{struct____strapframe__t}{\+\_\+\+\_\+strapframe\+\_\+t}} \mbox{\hyperlink{trapframe_8h_ace23faaa1579bcc09327b838e4f18145}{strapframe\+\_\+t}}
\begin{DoxyCompactList}\small\item\em {\ttfamily strapframe\+\_\+t}是{\ttfamily S\+BI}陷入帧(\+S\+B\+I Trap Frame), 在保存通用寄存器的基础上, 额外保存了{\ttfamily empc}寄存器和{\ttfamily mstatus}寄存器 \end{DoxyCompactList}\item 
\mbox{\Hypertarget{trapframe_8h_a8ee2ed696d45e589b6afcbb4c3a4f47a}\label{trapframe_8h_a8ee2ed696d45e589b6afcbb4c3a4f47a}} 
typedef struct \mbox{\hyperlink{struct____ktrapframe__t}{\+\_\+\+\_\+ktrapframe\+\_\+t}} \mbox{\hyperlink{trapframe_8h_a8ee2ed696d45e589b6afcbb4c3a4f47a}{ktrapframe\+\_\+t}}
\begin{DoxyCompactList}\small\item\em {\ttfamily ktrapframe\+\_\+t}是{\ttfamily Kernel}陷入帧(\+Kernel Trap Frame), 在保存通用寄存器的基础上, 额外保存了{\ttfamily sepc}, {\ttfamily sstatus}, {\ttfamily sbadaddr}, {\ttfamily scause}等寄存器 \end{DoxyCompactList}\item 
\mbox{\Hypertarget{trapframe_8h_ab7fb0a8d1c81ba64631d0af5eeae5336}\label{trapframe_8h_ab7fb0a8d1c81ba64631d0af5eeae5336}} 
typedef \mbox{\hyperlink{types_8h_a186ea1339bffb378854987065835afe3}{size\+\_\+t}}($\ast$ \mbox{\hyperlink{trapframe_8h_ab7fb0a8d1c81ba64631d0af5eeae5336}{printf\+\_\+t}}) (const char $\ast$format,...)
\begin{DoxyCompactList}\small\item\em {\ttfamily printf\+\_\+t}是输出函数类型 \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{函数}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{trapframe_8h_aa2c72627c8a7364d0ffa8b93f3b9ebe4}{print\+\_\+gtrapframe}} (\mbox{\hyperlink{trapframe_8h_ac7135428295a151a70d7b6de6ae41a3d}{gtrapframe\+\_\+t}} $\ast$gtf\+\_\+ptr, \mbox{\hyperlink{trapframe_8h_ab7fb0a8d1c81ba64631d0af5eeae5336}{printf\+\_\+t}} print\+\_\+func)
\begin{DoxyCompactList}\small\item\em {\ttfamily print\+\_\+gtrapframe}用于输出通用陷入帧{\ttfamily gtf\+\_\+ptr} \end{DoxyCompactList}\item 
void \mbox{\hyperlink{trapframe_8h_af3b65ddc32145c57dd729fd2f926ce44}{print\+\_\+strapframe}} (\mbox{\hyperlink{trapframe_8h_ace23faaa1579bcc09327b838e4f18145}{strapframe\+\_\+t}} $\ast$stf\+\_\+ptr, \mbox{\hyperlink{trapframe_8h_ab7fb0a8d1c81ba64631d0af5eeae5336}{printf\+\_\+t}} print\+\_\+func)
\begin{DoxyCompactList}\small\item\em {\ttfamily print\+\_\+strapframe}用于输出{\ttfamily S\+BI}陷入帧{\ttfamily stf\+\_\+ptr} \end{DoxyCompactList}\item 
void \mbox{\hyperlink{trapframe_8h_a63953911ad2767d9f6001c191cde476b}{print\+\_\+ktrapframe}} (\mbox{\hyperlink{trapframe_8h_a8ee2ed696d45e589b6afcbb4c3a4f47a}{ktrapframe\+\_\+t}} $\ast$ktf\+\_\+ptr, \mbox{\hyperlink{trapframe_8h_ab7fb0a8d1c81ba64631d0af5eeae5336}{printf\+\_\+t}} print\+\_\+func)
\begin{DoxyCompactList}\small\item\em {\ttfamily print\+\_\+ktrapframe}用于输出内核陷入帧{\ttfamily ktf\+\_\+ptr} \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{详细描述}
{\ttfamily \mbox{\hyperlink{trapframe_8h}{trapframe.\+h}}}中定义了通用的陷入帧{\ttfamily gtrapframe\+\_\+t} 

\begin{DoxyAuthor}{作者}
Shihong Wang (\href{mailto:jack4shihong@gmail.com}{\texttt{ jack4shihong@gmail.\+com}}) 
\end{DoxyAuthor}
\begin{DoxyVersion}{版本}
0.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{日期}
2023-\/04-\/19
\end{DoxyDate}
\begin{DoxyCopyright}{版权所有}
Copyright Shihong Wang (c) 2023 with G\+NU Public License V3.\+0 
\end{DoxyCopyright}


\doxysubsection{类型定义说明}
\mbox{\Hypertarget{trapframe_8h_ac7135428295a151a70d7b6de6ae41a3d}\label{trapframe_8h_ac7135428295a151a70d7b6de6ae41a3d}} 
\index{trapframe.h@{trapframe.h}!gtrapframe\_t@{gtrapframe\_t}}
\index{gtrapframe\_t@{gtrapframe\_t}!trapframe.h@{trapframe.h}}
\doxysubsubsection{\texorpdfstring{gtrapframe\_t}{gtrapframe\_t}}
{\footnotesize\ttfamily typedef struct \mbox{\hyperlink{struct____gtrapframe__t}{\+\_\+\+\_\+gtrapframe\+\_\+t}} \mbox{\hyperlink{trapframe_8h_ac7135428295a151a70d7b6de6ae41a3d}{gtrapframe\+\_\+t}}}



{\ttfamily gtrapframe\+\_\+t}是通用陷入帧(\+General Trap Frame), 主要用于陷入中断/异常保存通用寄存器, 以方便在退出中断/异常的时候恢复现场 

\begin{DoxyNote}{注解}

\begin{DoxyEnumerate}
\item {\ttfamily gtrapframe\+\_\+t}是否包含浮点寄存器取决于{\ttfamily constrain.\+h}的{\ttfamily W\+I\+T\+H\+\_\+\+F\+P\+\_\+\+R\+EG}宏\+:
\begin{DoxyItemize}
\item {\ttfamily W\+I\+T\+H\+\_\+\+F\+P\+\_\+\+R\+EG = 0}, 不包含浮点寄存器, 此时保存\+: {\ttfamily x1$\sim$x31} 寄存器. 一共 31 个寄存器, 共 248 字节
\item {\ttfamily W\+I\+T\+H\+\_\+\+F\+P\+\_\+\+R\+EG = 1}, 包含浮点寄存器, 此时保存\+: {\ttfamily x1$\sim$x31}, {\ttfamily f0$\sim$f31} 一共 31 + 32 个寄存器, 共 248 + 128 字节
\end{DoxyItemize}
\item 寄存器命名规则参考\+: R\+I\+S\+C-\/V Assembly Programmer’s Handbook
\end{DoxyEnumerate}
\end{DoxyNote}
\begin{DoxyWarning}{警告}
目前不支持浮点寄存器, 支持浮点寄存器的话, 需要额外修改trap\+\_\+entry.\+S里的汇编入口函数来保存 
\end{DoxyWarning}


\doxysubsection{函数说明}
\mbox{\Hypertarget{trapframe_8h_aa2c72627c8a7364d0ffa8b93f3b9ebe4}\label{trapframe_8h_aa2c72627c8a7364d0ffa8b93f3b9ebe4}} 
\index{trapframe.h@{trapframe.h}!print\_gtrapframe@{print\_gtrapframe}}
\index{print\_gtrapframe@{print\_gtrapframe}!trapframe.h@{trapframe.h}}
\doxysubsubsection{\texorpdfstring{print\_gtrapframe()}{print\_gtrapframe()}}
{\footnotesize\ttfamily void print\+\_\+gtrapframe (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{trapframe_8h_ac7135428295a151a70d7b6de6ae41a3d}{gtrapframe\+\_\+t}} $\ast$}]{gtf\+\_\+ptr,  }\item[{\mbox{\hyperlink{trapframe_8h_ab7fb0a8d1c81ba64631d0af5eeae5336}{printf\+\_\+t}}}]{print\+\_\+func }\end{DoxyParamCaption})}



{\ttfamily print\+\_\+gtrapframe}用于输出通用陷入帧{\ttfamily gtf\+\_\+ptr} 


\begin{DoxyParams}{参数}
{\em gtf\+\_\+ptr} & 指向要输出的通用陷入帧的指针 \\
\hline
{\em print\+\_\+func} & printf函数, 可以是\+: {\ttfamily bprintf}, {\ttfamily kprintf}, {\ttfamily uprintf} \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{trapframe_8h_a63953911ad2767d9f6001c191cde476b}\label{trapframe_8h_a63953911ad2767d9f6001c191cde476b}} 
\index{trapframe.h@{trapframe.h}!print\_ktrapframe@{print\_ktrapframe}}
\index{print\_ktrapframe@{print\_ktrapframe}!trapframe.h@{trapframe.h}}
\doxysubsubsection{\texorpdfstring{print\_ktrapframe()}{print\_ktrapframe()}}
{\footnotesize\ttfamily void print\+\_\+ktrapframe (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{trapframe_8h_a8ee2ed696d45e589b6afcbb4c3a4f47a}{ktrapframe\+\_\+t}} $\ast$}]{ktf\+\_\+ptr,  }\item[{\mbox{\hyperlink{trapframe_8h_ab7fb0a8d1c81ba64631d0af5eeae5336}{printf\+\_\+t}}}]{print\+\_\+func }\end{DoxyParamCaption})}



{\ttfamily print\+\_\+ktrapframe}用于输出内核陷入帧{\ttfamily ktf\+\_\+ptr} 


\begin{DoxyParams}{参数}
{\em ktf\+\_\+ptr} & 指向要输出的内核陷入帧的指针 \\
\hline
{\em print\+\_\+func} & printf函数, 可以是\+: {\ttfamily bprintf}, {\ttfamily kprintf}, {\ttfamily uprintf} \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{trapframe_8h_af3b65ddc32145c57dd729fd2f926ce44}\label{trapframe_8h_af3b65ddc32145c57dd729fd2f926ce44}} 
\index{trapframe.h@{trapframe.h}!print\_strapframe@{print\_strapframe}}
\index{print\_strapframe@{print\_strapframe}!trapframe.h@{trapframe.h}}
\doxysubsubsection{\texorpdfstring{print\_strapframe()}{print\_strapframe()}}
{\footnotesize\ttfamily void print\+\_\+strapframe (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{trapframe_8h_ace23faaa1579bcc09327b838e4f18145}{strapframe\+\_\+t}} $\ast$}]{stf\+\_\+ptr,  }\item[{\mbox{\hyperlink{trapframe_8h_ab7fb0a8d1c81ba64631d0af5eeae5336}{printf\+\_\+t}}}]{print\+\_\+func }\end{DoxyParamCaption})}



{\ttfamily print\+\_\+strapframe}用于输出{\ttfamily S\+BI}陷入帧{\ttfamily stf\+\_\+ptr} 


\begin{DoxyParams}{参数}
{\em stf\+\_\+ptr} & 指向要输出的{\ttfamily S\+BI}陷入帧的指针 \\
\hline
{\em print\+\_\+func} & printf函数, 可以是\+: {\ttfamily bprintf}, {\ttfamily kprintf}, {\ttfamily uprintf} \\
\hline
\end{DoxyParams}
