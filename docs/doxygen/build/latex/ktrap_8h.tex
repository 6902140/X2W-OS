\hypertarget{ktrap_8h}{}\doxysection{/home/data/proj/oskernel2023-\/x2w/include/kernel/ktrap.h 文件参考}
\label{ktrap_8h}\index{/home/data/proj/oskernel2023-\/x2w/include/kernel/ktrap.h@{/home/data/proj/oskernel2023-\/x2w/include/kernel/ktrap.h}}


{\ttfamily \mbox{\hyperlink{ktrap_8h}{ktrap.\+h}}}是内核的异常/中断管理模块  


{\ttfamily \#include \char`\"{}types.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}constrains.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}trap/trapframe.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}trap/trap\+\_\+entry.\+h\char`\"{}}\newline
\doxysubsection*{类型定义}
\begin{DoxyCompactItemize}
\item 
typedef \mbox{\hyperlink{types_8h_a312c7e8848187d110315ab83a7b3d4d0}{int64\+\_\+t}}($\ast$ \mbox{\hyperlink{ktrap_8h_a76e5a21e48082c1e8528c7492bd6e17e}{ktrap\+\_\+handler\+\_\+t}}) (\mbox{\hyperlink{trapframe_8h_a8ee2ed696d45e589b6afcbb4c3a4f47a}{ktrapframe\+\_\+t}} $\ast$ktf\+\_\+ptr)
\begin{DoxyCompactList}\small\item\em {\ttfamily ktrap\+\_\+handler\+\_\+t}是异常/中断处理函数的函数类型, 函数原型为\+: {\ttfamily int64\+\_\+t funcname(struct ktrapframe\+\_\+t$\ast$)} \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{函数}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{ktrap_8h_ad56176f05c2f0267519279829eb808a8}\label{ktrap_8h_ad56176f05c2f0267519279829eb808a8}} 
void \mbox{\hyperlink{ktrap_8h_ad56176f05c2f0267519279829eb808a8}{ktrap\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em {\ttfamily ktrap\+\_\+init}是内核的异常/中断初始化函数 \end{DoxyCompactList}\item 
void \mbox{\hyperlink{ktrap_8h_adfc16fb510aca95468679687c1ea70f9}{ktrap\+\_\+dispatcher}} (\mbox{\hyperlink{trapframe_8h_a8ee2ed696d45e589b6afcbb4c3a4f47a}{ktrapframe\+\_\+t}} $\ast$ktf\+\_\+ptr)
\begin{DoxyCompactList}\small\item\em {\ttfamily ktrap\+\_\+dispatcher}是通用异常/中断处理函数, 将会根据{\ttfamily scause}寄存器的值运行不同的中断处理函数 \end{DoxyCompactList}\item 
void \mbox{\hyperlink{ktrap_8h_a39bfae2bfe8bb03d16b80eb47bc629fb}{regitser\+\_\+ktrap\+\_\+handler}} (\mbox{\hyperlink{types_8h_aa232ecf786a74ce5363c36c10798d2b1}{uint64\+\_\+t}} trap\+\_\+code, \mbox{\hyperlink{types_8h_a253b248072cfc8bd812c69acd0046eed}{Bool}} interrupt, const char $\ast$msg, \mbox{\hyperlink{ktrap_8h_a76e5a21e48082c1e8528c7492bd6e17e}{ktrap\+\_\+handler\+\_\+t}} ktrap\+\_\+func)
\begin{DoxyCompactList}\small\item\em {\ttfamily regitser\+\_\+ktrap\+\_\+handler}是{\ttfamily S\+BI}异常/中断注册函数, 用于将编号为{\ttfamily trap\+\_\+code}的异常/中断的处理函数{\ttfamily ktrap\+\_\+func}注册到{\ttfamily S\+BI}的异常/中断处理函数表中 \end{DoxyCompactList}\item 
\mbox{\hyperlink{types_8h_a9bc43e3ee0ae83643b65e07fe1fd0132}{N\+O\+\_\+\+R\+E\+T\+U\+RN}} \mbox{\hyperlink{types_8h_a312c7e8848187d110315ab83a7b3d4d0}{int64\+\_\+t}} \mbox{\hyperlink{ktrap_8h_abf30d23fd138658722ddf720e128e373}{general\+\_\+ktrap\+\_\+handler}} (\mbox{\hyperlink{trapframe_8h_a8ee2ed696d45e589b6afcbb4c3a4f47a}{ktrapframe\+\_\+t}} $\ast$ktf\+\_\+ptr)
\begin{DoxyCompactList}\small\item\em {\ttfamily general\+\_\+ktrap\+\_\+handler}是所有中断/异常的缺省处理函数, 将会在屏幕上输出中断/异常信息, 打印陷入帧, 而后挂起内核 \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{详细描述}
{\ttfamily \mbox{\hyperlink{ktrap_8h}{ktrap.\+h}}}是内核的异常/中断管理模块 

\begin{DoxyAuthor}{作者}
Shihong Wang (\href{mailto:jack4shihong@gmail.com}{\texttt{ jack4shihong@gmail.\+com}}) 
\end{DoxyAuthor}
\begin{DoxyVersion}{版本}
0.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{日期}
2023-\/04-\/20
\end{DoxyDate}
\begin{DoxyCopyright}{版权所有}
Copyright Shihong Wang (c) 2023 with G\+NU Public License V3.\+0 
\end{DoxyCopyright}


\doxysubsection{类型定义说明}
\mbox{\Hypertarget{ktrap_8h_a76e5a21e48082c1e8528c7492bd6e17e}\label{ktrap_8h_a76e5a21e48082c1e8528c7492bd6e17e}} 
\index{ktrap.h@{ktrap.h}!ktrap\_handler\_t@{ktrap\_handler\_t}}
\index{ktrap\_handler\_t@{ktrap\_handler\_t}!ktrap.h@{ktrap.h}}
\doxysubsubsection{\texorpdfstring{ktrap\_handler\_t}{ktrap\_handler\_t}}
{\footnotesize\ttfamily typedef \mbox{\hyperlink{types_8h_a312c7e8848187d110315ab83a7b3d4d0}{int64\+\_\+t}}($\ast$ ktrap\+\_\+handler\+\_\+t) (\mbox{\hyperlink{trapframe_8h_a8ee2ed696d45e589b6afcbb4c3a4f47a}{ktrapframe\+\_\+t}} $\ast$ktf\+\_\+ptr)}



{\ttfamily ktrap\+\_\+handler\+\_\+t}是异常/中断处理函数的函数类型, 函数原型为\+: {\ttfamily int64\+\_\+t funcname(struct ktrapframe\+\_\+t$\ast$)} 


\begin{DoxyParams}{参数}
{\em ktf\+\_\+ptr} & 指向被打断的程序的陷入帧, 程序的陷入帧将在{\ttfamily ktrap\+\_\+enter}中构建在{\ttfamily S模式}的栈中\\
\hline
\end{DoxyParams}
\begin{DoxyNote}{注解}
如果被打断的程序想要传参给异常/中断处理函数, 那么必须要通过寄存器来实现, 而所有的通用寄存器在{\ttfamily ktrap\+\_\+enter}函数中会被保存到陷入帧中. 所以异常/中断处理函数必然可以通过陷入栈来获得被打断的程序传入的参数

R\+I\+S\+C-\/\+V通过{\ttfamily a0$\sim$a7}寄存器传参, 因此在{\ttfamily ktrap\+\_\+enter}中要把{\ttfamily ktrapframe}的地址保存到{\ttfamily a0}寄存器中 
\end{DoxyNote}


\doxysubsection{函数说明}
\mbox{\Hypertarget{ktrap_8h_abf30d23fd138658722ddf720e128e373}\label{ktrap_8h_abf30d23fd138658722ddf720e128e373}} 
\index{ktrap.h@{ktrap.h}!general\_ktrap\_handler@{general\_ktrap\_handler}}
\index{general\_ktrap\_handler@{general\_ktrap\_handler}!ktrap.h@{ktrap.h}}
\doxysubsubsection{\texorpdfstring{general\_ktrap\_handler()}{general\_ktrap\_handler()}}
{\footnotesize\ttfamily \mbox{\hyperlink{types_8h_a9bc43e3ee0ae83643b65e07fe1fd0132}{N\+O\+\_\+\+R\+E\+T\+U\+RN}} \mbox{\hyperlink{types_8h_a312c7e8848187d110315ab83a7b3d4d0}{int64\+\_\+t}} general\+\_\+ktrap\+\_\+handler (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{trapframe_8h_a8ee2ed696d45e589b6afcbb4c3a4f47a}{ktrapframe\+\_\+t}} $\ast$}]{ktf\+\_\+ptr }\end{DoxyParamCaption})}



{\ttfamily general\+\_\+ktrap\+\_\+handler}是所有中断/异常的缺省处理函数, 将会在屏幕上输出中断/异常信息, 打印陷入帧, 而后挂起内核 


\begin{DoxyParams}{参数}
{\em ktf\+\_\+ptr} & 保存被中断的程序上下文信息(所有通用寄存器和部分\+C\+S\+R寄存器)的陷入栈, 在{\ttfamily ktrap\+\_\+enter}中构建 \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{返回}
N\+O\+\_\+\+R\+E\+T\+U\+RN 该函数将挂起内核, 不会返回至内核继续运行 
\end{DoxyReturn}
\mbox{\Hypertarget{ktrap_8h_adfc16fb510aca95468679687c1ea70f9}\label{ktrap_8h_adfc16fb510aca95468679687c1ea70f9}} 
\index{ktrap.h@{ktrap.h}!ktrap\_dispatcher@{ktrap\_dispatcher}}
\index{ktrap\_dispatcher@{ktrap\_dispatcher}!ktrap.h@{ktrap.h}}
\doxysubsubsection{\texorpdfstring{ktrap\_dispatcher()}{ktrap\_dispatcher()}}
{\footnotesize\ttfamily void ktrap\+\_\+dispatcher (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{trapframe_8h_a8ee2ed696d45e589b6afcbb4c3a4f47a}{ktrapframe\+\_\+t}} $\ast$}]{ktf\+\_\+ptr }\end{DoxyParamCaption})}



{\ttfamily ktrap\+\_\+dispatcher}是通用异常/中断处理函数, 将会根据{\ttfamily scause}寄存器的值运行不同的中断处理函数 


\begin{DoxyParams}{参数}
{\em ktf\+\_\+ptr} & 保存被中断的程序上下文信息(所有通用寄存器和部分\+C\+S\+R寄存器)的陷入栈, 在{\ttfamily ktrap\+\_\+enter}中构建 \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{ktrap_8h_a39bfae2bfe8bb03d16b80eb47bc629fb}\label{ktrap_8h_a39bfae2bfe8bb03d16b80eb47bc629fb}} 
\index{ktrap.h@{ktrap.h}!regitser\_ktrap\_handler@{regitser\_ktrap\_handler}}
\index{regitser\_ktrap\_handler@{regitser\_ktrap\_handler}!ktrap.h@{ktrap.h}}
\doxysubsubsection{\texorpdfstring{regitser\_ktrap\_handler()}{regitser\_ktrap\_handler()}}
{\footnotesize\ttfamily void regitser\+\_\+ktrap\+\_\+handler (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{types_8h_aa232ecf786a74ce5363c36c10798d2b1}{uint64\+\_\+t}}}]{trap\+\_\+code,  }\item[{\mbox{\hyperlink{types_8h_a253b248072cfc8bd812c69acd0046eed}{Bool}}}]{interrupt,  }\item[{const char $\ast$}]{msg,  }\item[{\mbox{\hyperlink{ktrap_8h_a76e5a21e48082c1e8528c7492bd6e17e}{ktrap\+\_\+handler\+\_\+t}}}]{ktrap\+\_\+func }\end{DoxyParamCaption})}



{\ttfamily regitser\+\_\+ktrap\+\_\+handler}是{\ttfamily S\+BI}异常/中断注册函数, 用于将编号为{\ttfamily trap\+\_\+code}的异常/中断的处理函数{\ttfamily ktrap\+\_\+func}注册到{\ttfamily S\+BI}的异常/中断处理函数表中 


\begin{DoxyParams}{参数}
{\em trap\+\_\+code} & 注册的中断/异常的编号 \\
\hline
{\em interrupt} & 若为\+True, 则将处理函数注册为中断处理函数, 否则注册为异常处理函数 \\
\hline
{\em msg} & 中断的相关信息 \\
\hline
{\em ktrap\+\_\+func} & 中断/异常处理函数, 需要为类型{\ttfamily ktrap\+\_\+handler\+\_\+t}, 即函数原型需要为{\ttfamily int64\+\_\+t funcname(ireg\+\_\+t kcause)} \\
\hline
\end{DoxyParams}
