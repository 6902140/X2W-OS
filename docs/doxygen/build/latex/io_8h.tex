\hypertarget{io_8h}{}\doxysection{/home/data/proj/oskernel2023-\/x2w/include/io.h 文件参考}
\label{io_8h}\index{/home/data/proj/oskernel2023-\/x2w/include/io.h@{/home/data/proj/oskernel2023-\/x2w/include/io.h}}


{\ttfamily \mbox{\hyperlink{io_8h}{io.\+h}}}中提供了{\ttfamily io}操作函数  


{\ttfamily \#include \char`\"{}types.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}constrains.\+h\char`\"{}}\newline
\doxysubsection*{宏定义}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{io_8h_a3c3e456bfd6d0406bc6e20318da1760b}{dmb}}()~\+\_\+\+\_\+asm\+\_\+\+\_\+ \+\_\+\+\_\+volatile\+\_\+\+\_\+ (\char`\"{}\char`\"{} \+: \+: \+: \char`\"{}memory\char`\"{})
\begin{DoxyCompactList}\small\item\em {\ttfamily dmb}({\ttfamily Define Memory Barrier})定义了内存屏障({\ttfamily Memory Barrier}) \end{DoxyCompactList}\item 
\mbox{\Hypertarget{io_8h_aa2972611d217f2dd8bf17d8e5a9df24c}\label{io_8h_aa2972611d217f2dd8bf17d8e5a9df24c}} 
\#define \mbox{\hyperlink{io_8h_aa2972611d217f2dd8bf17d8e5a9df24c}{\+\_\+\+\_\+iormb}}()~\mbox{\hyperlink{io_8h_a3c3e456bfd6d0406bc6e20318da1760b}{dmb}}()
\begin{DoxyCompactList}\small\item\em {\ttfamily \+\_\+\+\_\+iormb} 定义了读取寄存器的内存屏障 \end{DoxyCompactList}\item 
\mbox{\Hypertarget{io_8h_a76c5ac1cb98b83819b9cedd10ab863ca}\label{io_8h_a76c5ac1cb98b83819b9cedd10ab863ca}} 
\#define \mbox{\hyperlink{io_8h_a76c5ac1cb98b83819b9cedd10ab863ca}{\+\_\+\+\_\+iowmb}}()~\mbox{\hyperlink{io_8h_a3c3e456bfd6d0406bc6e20318da1760b}{dmb}}()
\begin{DoxyCompactList}\small\item\em {\ttfamily \+\_\+\+\_\+iowmb} 定义了写入寄存器的内存屏障 \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{io_8h_a5c466414909380bc82d6d28e35193e7f}{glue}}(x,  y,  z)~x \#\# \+\_\+ \#\# y \#\# \+\_\+ \#\# z
\begin{DoxyCompactList}\small\item\em {\ttfamily glue}用于将符号{\ttfamily x}, {\ttfamily y}, {\ttfamily z}拼接为符号{\ttfamily x\+\_\+y\+\_\+z} \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{io_8h_ac2eaa508b61574c8081061907488e005}{mkname}}(type,  width)~\mbox{\hyperlink{io_8h_a5c466414909380bc82d6d28e35193e7f}{glue}}(type, width, bits)
\begin{DoxyCompactList}\small\item\em {\ttfamily mkname}用于方便的拼接得到函数名 \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{io_8h_a04306cf4d238a563ec6e862b546dc590}{mkread}}(width)
\begin{DoxyCompactList}\small\item\em {\ttfamily mkread}用于生成读不同长度寄存器的函数 \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{io_8h_a59e4e10887e0e4c54d738802bf969f1c}{mkwrite}}(width)
\begin{DoxyCompactList}\small\item\em {\ttfamily mkwrite}用于生成写不同长度寄存器的函数 \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{函数}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{io_8h_af5323b9c9edb836d4c9a0caf30b8755c}\label{io_8h_af5323b9c9edb836d4c9a0caf30b8755c}} 
{\bfseries mkread} (8)
\item 
\mbox{\Hypertarget{io_8h_ae58e19d2fe95ee545850125e2cf044fe}\label{io_8h_ae58e19d2fe95ee545850125e2cf044fe}} 
{\bfseries mkread} (16)
\item 
\mbox{\Hypertarget{io_8h_a10c5fcbf785b7116785adce25a7eb59c}\label{io_8h_a10c5fcbf785b7116785adce25a7eb59c}} 
{\bfseries mkread} (32)
\item 
\mbox{\Hypertarget{io_8h_ae19e962b9bf6616b46865283e6f13206}\label{io_8h_ae19e962b9bf6616b46865283e6f13206}} 
{\bfseries mkread} (64)
\item 
\mbox{\Hypertarget{io_8h_a7a4cd0abcc5f7d5123b60acc8d457684}\label{io_8h_a7a4cd0abcc5f7d5123b60acc8d457684}} 
{\bfseries mkwrite} (8)
\item 
\mbox{\Hypertarget{io_8h_ac199dfaa00c7aaeccf12f9657b3e76f4}\label{io_8h_ac199dfaa00c7aaeccf12f9657b3e76f4}} 
{\bfseries mkwrite} (16)
\item 
\mbox{\Hypertarget{io_8h_ae67e4a6176af3ef355f7c71884c46e52}\label{io_8h_ae67e4a6176af3ef355f7c71884c46e52}} 
{\bfseries mkwrite} (32)
\item 
\mbox{\Hypertarget{io_8h_a3871a02099ba5ff1fe0de444078f6afc}\label{io_8h_a3871a02099ba5ff1fe0de444078f6afc}} 
{\bfseries mkwrite} (64)
\end{DoxyCompactItemize}


\doxysubsection{详细描述}
{\ttfamily \mbox{\hyperlink{io_8h}{io.\+h}}}中提供了{\ttfamily io}操作函数 

\begin{DoxyAuthor}{作者}
Shihong Wang (\href{mailto:jack4shihong@gmail.com}{\texttt{ jack4shihong@gmail.\+com}}) 
\end{DoxyAuthor}
\begin{DoxyVersion}{版本}
0.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{日期}
2023-\/04-\/09
\end{DoxyDate}
\begin{DoxyNote}{注解}
{\ttfamily R\+I\+S\+C-\/V}通过{\ttfamily Memory Mapping IO} ({\ttfamily M\+M\+IO})的方式操作设备寄存器. 关于具体的{\ttfamily M\+M\+IO Map}, 参阅{\ttfamily Q\+E\+MU}中的{\ttfamily virt\+\_\+memmap\mbox{[}\mbox{]}}\+: \href{https://github.com/qemu/qemu/blob/master/hw/riscv/virt.c}{\texttt{ https\+://github.\+com/qemu/qemu/blob/master/hw/riscv/virt.\+c}}
\end{DoxyNote}
\begin{DoxyCopyright}{版权所有}
Copyright Shihong Wang (c) 2023 with G\+NU Public License V3.\+0 
\end{DoxyCopyright}


\doxysubsection{宏定义说明}
\mbox{\Hypertarget{io_8h_a3c3e456bfd6d0406bc6e20318da1760b}\label{io_8h_a3c3e456bfd6d0406bc6e20318da1760b}} 
\index{io.h@{io.h}!dmb@{dmb}}
\index{dmb@{dmb}!io.h@{io.h}}
\doxysubsubsection{\texorpdfstring{dmb}{dmb}}
{\footnotesize\ttfamily \#define dmb(\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})~\+\_\+\+\_\+asm\+\_\+\+\_\+ \+\_\+\+\_\+volatile\+\_\+\+\_\+ (\char`\"{}\char`\"{} \+: \+: \+: \char`\"{}memory\char`\"{})}



{\ttfamily dmb}({\ttfamily Define Memory Barrier})定义了内存屏障({\ttfamily Memory Barrier}) 

\begin{DoxyNote}{注解}
关于内存屏障, 参考\+:
\begin{DoxyItemize}
\item {\ttfamily G\+CC}优化\+: \href{https://www.cnblogs.com/nufangrensheng/p/3890856.html}{\texttt{ https\+://www.\+cnblogs.\+com/nufangrensheng/p/3890856.\+html}}
\item 内存屏障原理\+: \href{https://stackoverflow.com/questions/14950614/working-of-asm-volatile-memory}{\texttt{ https\+://stackoverflow.\+com/questions/14950614/working-\/of-\/asm-\/volatile-\/memory}} 
\end{DoxyItemize}
\end{DoxyNote}
\mbox{\Hypertarget{io_8h_a5c466414909380bc82d6d28e35193e7f}\label{io_8h_a5c466414909380bc82d6d28e35193e7f}} 
\index{io.h@{io.h}!glue@{glue}}
\index{glue@{glue}!io.h@{io.h}}
\doxysubsubsection{\texorpdfstring{glue}{glue}}
{\footnotesize\ttfamily \#define glue(\begin{DoxyParamCaption}\item[{}]{x,  }\item[{}]{y,  }\item[{}]{z }\end{DoxyParamCaption})~x \#\# \+\_\+ \#\# y \#\# \+\_\+ \#\# z}



{\ttfamily glue}用于将符号{\ttfamily x}, {\ttfamily y}, {\ttfamily z}拼接为符号{\ttfamily x\+\_\+y\+\_\+z} 


\begin{DoxyParams}{参数}
{\em x} & 第一个符号 \\
\hline
{\em y} & 第二个符号 \\
\hline
{\em z} & 第三个符号 \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{io_8h_ac2eaa508b61574c8081061907488e005}\label{io_8h_ac2eaa508b61574c8081061907488e005}} 
\index{io.h@{io.h}!mkname@{mkname}}
\index{mkname@{mkname}!io.h@{io.h}}
\doxysubsubsection{\texorpdfstring{mkname}{mkname}}
{\footnotesize\ttfamily \#define mkname(\begin{DoxyParamCaption}\item[{}]{type,  }\item[{}]{width }\end{DoxyParamCaption})~\mbox{\hyperlink{io_8h_a5c466414909380bc82d6d28e35193e7f}{glue}}(type, width, bits)}



{\ttfamily mkname}用于方便的拼接得到函数名 


\begin{DoxyParams}{参数}
{\em type} & 读还是写寄存器, 只能是read或write \\
\hline
{\em width} & 读写的位数 \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{io_8h_a04306cf4d238a563ec6e862b546dc590}\label{io_8h_a04306cf4d238a563ec6e862b546dc590}} 
\index{io.h@{io.h}!mkread@{mkread}}
\index{mkread@{mkread}!io.h@{io.h}}
\doxysubsubsection{\texorpdfstring{mkread}{mkread}}
{\footnotesize\ttfamily \#define mkread(\begin{DoxyParamCaption}\item[{}]{width }\end{DoxyParamCaption})}

{\bfseries 值\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{static} \textcolor{keyword}{inline} uint\#\#width\#\#\_t \mbox{\hyperlink{io_8h_ac2eaa508b61574c8081061907488e005}{mkname}}(read, width)(\mbox{\hyperlink{types_8h_aa232ecf786a74ce5363c36c10798d2b1}{uint64\_t}} addr)\{ \(\backslash\)}
\DoxyCodeLine{    uint\#\#width\#\#\_t \_\_v = *(\textcolor{keyword}{volatile} uint\#\#width\#\#\_t*)addr; \(\backslash\)}
\DoxyCodeLine{    \_\_iormb(); \(\backslash\)}
\DoxyCodeLine{    return \_\_v; \(\backslash\)}
\DoxyCodeLine{\}}

\end{DoxyCode}


{\ttfamily mkread}用于生成读不同长度寄存器的函数 


\begin{DoxyParams}{参数}
{\em width} & 读取的位数\\
\hline
\end{DoxyParams}
\begin{DoxyNote}{注解}
通常情况下，在内联汇编代码块的最后一条语句中将需要返回的值存储在一个特定的变量中，然后该变量将被作为代码块的返回值返回给调用者。在\+G\+C\+C扩展中，这个变量通常被命名为\+\_\+\+\_\+v（两个下划线 + v），并且在代码块的最后一行写上\+\_\+\+\_\+v;语句来表示将其作为返回值返回给调用者。 

因为地址的值(寄存器的值)可能会被设备改变, 因此必须声明是volatile, 以避免\+G\+C\+C进行优化 
\end{DoxyNote}
\mbox{\Hypertarget{io_8h_a59e4e10887e0e4c54d738802bf969f1c}\label{io_8h_a59e4e10887e0e4c54d738802bf969f1c}} 
\index{io.h@{io.h}!mkwrite@{mkwrite}}
\index{mkwrite@{mkwrite}!io.h@{io.h}}
\doxysubsubsection{\texorpdfstring{mkwrite}{mkwrite}}
{\footnotesize\ttfamily \#define mkwrite(\begin{DoxyParamCaption}\item[{}]{width }\end{DoxyParamCaption})}

{\bfseries 值\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{io_8h_ac2eaa508b61574c8081061907488e005}{mkname}}(write, width)(\mbox{\hyperlink{types_8h_aa232ecf786a74ce5363c36c10798d2b1}{uint64\_t}} addr, uint\#\#width\#\#\_t value)\{ \(\backslash\)}
\DoxyCodeLine{    uint\#\#width\#\#\_t \_\_v = value; \(\backslash\)}
\DoxyCodeLine{    \_\_iowmb(); \(\backslash\)}
\DoxyCodeLine{    *(\textcolor{keyword}{volatile} uint\#\#width\#\#\_t*)addr = \_\_v; \(\backslash\)}
\DoxyCodeLine{\}}

\end{DoxyCode}


{\ttfamily mkwrite}用于生成写不同长度寄存器的函数 


\begin{DoxyParams}{参数}
{\em width} & 写入的位数\\
\hline
\end{DoxyParams}
\begin{DoxyNote}{注解}
因为地址的值(寄存器的值)可能会被设备改变, 因此必须声明是volatile, 以避免\+G\+C\+C进行优化 
\end{DoxyNote}
