\hypertarget{stdarg_8h}{}\doxysection{/home/data/proj/oskernel2023-\/x2w/include/stdarg.h 文件参考}
\label{stdarg_8h}\index{/home/data/proj/oskernel2023-\/x2w/include/stdarg.h@{/home/data/proj/oskernel2023-\/x2w/include/stdarg.h}}


{\ttfamily stdargs.\+h}提供了自定义的变参函数支持  


{\ttfamily \#include \char`\"{}types.\+h\char`\"{}}\newline
\doxysubsection*{宏定义}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{stdarg_8h_aab2fdb7b45868b2622028377c750dad9}{va\+\_\+start}}(ap,  v)~\+\_\+\+\_\+builtin\+\_\+va\+\_\+start(ap, v)
\begin{DoxyCompactList}\small\item\em {\ttfamily va\+\_\+start}用于将参数指针{\ttfamily ap}(argument pointer)指向第一个固定参数{\ttfamily v} \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{stdarg_8h_afeb46f660b756eb161fb4aa8969925c7}{va\+\_\+arg}}(ap,  t)~\+\_\+\+\_\+builtin\+\_\+va\+\_\+arg(ap, t)
\begin{DoxyCompactList}\small\item\em {\ttfamily va\+\_\+arg}用于将参数指针{\ttfamily ap}(argument pointer)指向栈中下一个类型为{\ttfamily t}的参数. \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{stdarg_8h_acd9b3b9085ec072324c5fdac2b40304e}{va\+\_\+end}}(ap)~\+\_\+\+\_\+builtin\+\_\+va\+\_\+end(ap)
\begin{DoxyCompactList}\small\item\em {\ttfamily \+\_\+my\+\_\+va\+\_\+end}用于清除参数指针{\ttfamily ap}(argument pointer) \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{stdarg_8h_ae641e06b00550c111ccb048aafe0fc4b}{\+\_\+my\+\_\+va\+\_\+start}}(ap,  v)~ap = (\mbox{\hyperlink{stdarg_8h_af53f622e3b6c080daeb167c1955d7ec1}{va\+\_\+list}}) \&v
\begin{DoxyCompactList}\small\item\em {\ttfamily \+\_\+my\+\_\+va\+\_\+start}用于将参数指针{\ttfamily ap}(argument pointer)指向第一个固定参数{\ttfamily v} \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{stdarg_8h_a7b0f2a88c33d642ab5d0298f3c4b3035}{\+\_\+my\+\_\+va\+\_\+arg}}(ap,  t)~$\ast$((t$\ast$)(ap += 8))
\begin{DoxyCompactList}\small\item\em {\ttfamily \+\_\+my\+\_\+va\+\_\+arg}用于将参数指针{\ttfamily ap}(argument pointer)指向栈中下一个类型为{\ttfamily t}的参数. \end{DoxyCompactList}\item 
\#define \mbox{\hyperlink{stdarg_8h_af6468ba7e0b5727b681dd3905208872d}{\+\_\+my\+\_\+va\+\_\+end}}(ap)~ap = \mbox{\hyperlink{types_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{N\+U\+LL}}
\begin{DoxyCompactList}\small\item\em {\ttfamily \+\_\+my\+\_\+va\+\_\+end}用于清除参数指针{\ttfamily ap}(argument pointer) \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{类型定义}
\begin{DoxyCompactItemize}
\item 
typedef \+\_\+\+\_\+builtin\+\_\+va\+\_\+list \mbox{\hyperlink{stdarg_8h_af53f622e3b6c080daeb167c1955d7ec1}{va\+\_\+list}}
\begin{DoxyCompactList}\small\item\em 变参列表类型, 本质就是一个指针, 因此也称为参数指针, 原理参考{\ttfamily G\+CC}编译器的传参原理 \end{DoxyCompactList}\item 
typedef char $\ast$ \mbox{\hyperlink{stdarg_8h_a7606ba07f197c44b4185b4ce441e0d76}{\+\_\+my\+\_\+va\+\_\+list}}
\begin{DoxyCompactList}\small\item\em 变参宏以字节形式处理在栈中的函数参数, 因此变参列表{\ttfamily \+\_\+my\+\_\+va\+\_\+list}的本质就是字节 \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{详细描述}
{\ttfamily stdargs.\+h}提供了自定义的变参函数支持 

\begin{DoxyAuthor}{作者}
Shihong Wang (\href{mailto:jack4shihong@gmail.com}{\texttt{ jack4shihong@gmail.\+com}}) 
\end{DoxyAuthor}
\begin{DoxyVersion}{版本}
0.\+2 
\end{DoxyVersion}
\begin{DoxyDate}{日期}
2023-\/04-\/09
\end{DoxyDate}
\begin{DoxyNote}{注解}
deprecated, 原因见下. {\ttfamily G\+CC}调用时函数时通过栈传参, 因此参数在函数调用栈帧中依次排列. 所以变参宏的本质就是以字节的形式处理在栈中的依次排列的函数参数.
\end{DoxyNote}
\begin{DoxyWarning}{警告}
自己原先写的{\ttfamily stdargs}有\+B\+UG, 因为\+:
\begin{DoxyEnumerate}
\item {\ttfamily x86-\/32} 是全部通过栈传参
\item {\ttfamily R\+I\+S\+C-\/V L\+P64}的abi不是按照栈传参的, 先用寄存器再用栈, 所以如果要自己实现的话, 需要操作寄存器和栈 所以为了屏蔽不同的体系结构的{\ttfamily A\+BI}的差异, {\ttfamily G\+CC}使用了内建的{\ttfamily \+\_\+\+\_\+builtin\+\_\+va\+\_\+list}, {\ttfamily \+\_\+\+\_\+builtin\+\_\+va\+\_\+start()}和 {\ttfamily \+\_\+\+\_\+builtin\+\_\+va\+\_\+end()} 因此如果需要自己实现{\ttfamily R\+I\+S\+V-\/C}的{\ttfamily stdargs.\+h}的话, 就得参考\+G\+C\+C源码中的{\ttfamily \+\_\+\+\_\+builtin\+\_\+va\+\_\+list}, {\ttfamily \+\_\+\+\_\+builtin\+\_\+va\+\_\+start()}和 {\ttfamily \+\_\+\+\_\+builtin\+\_\+va\+\_\+end()}的{\ttfamily R\+I\+S\+C-\/V}部分的实现 所以综合考虑, 还是直接需要使用{\ttfamily G\+CC}内建的 {\ttfamily \+\_\+\+\_\+builtin\+\_\+va\+\_\+list}, {\ttfamily \+\_\+\+\_\+builtin\+\_\+va\+\_\+start()}和 {\ttfamily \+\_\+\+\_\+builtin\+\_\+va\+\_\+end()}算了
\end{DoxyEnumerate}

所有我自己写的{\ttfamily stdargs.\+h}适用于{\ttfamily x86-\/32}, 已经全部加上了{\ttfamily \+\_\+my\+\_\+}的前缀
\end{DoxyWarning}
\begin{DoxyNote}{注解}
参考\+: $<$path-\/to-\/riscv-\/gnu-\/toolchain-\/installation-\/path$>$/lib/gcc/riscv64-\/unknown-\/elf/12.2.\+0/include/stdarg.h
\end{DoxyNote}
\begin{DoxyCopyright}{版权所有}
Copyright Shihong Wang (c) 2023 with G\+NU Public License V3.\+0 
\end{DoxyCopyright}


\doxysubsection{宏定义说明}
\mbox{\Hypertarget{stdarg_8h_a7b0f2a88c33d642ab5d0298f3c4b3035}\label{stdarg_8h_a7b0f2a88c33d642ab5d0298f3c4b3035}} 
\index{stdarg.h@{stdarg.h}!\_my\_va\_arg@{\_my\_va\_arg}}
\index{\_my\_va\_arg@{\_my\_va\_arg}!stdarg.h@{stdarg.h}}
\doxysubsubsection{\texorpdfstring{\_my\_va\_arg}{\_my\_va\_arg}}
{\footnotesize\ttfamily \#define \+\_\+my\+\_\+va\+\_\+arg(\begin{DoxyParamCaption}\item[{}]{ap,  }\item[{}]{t }\end{DoxyParamCaption})~$\ast$((t$\ast$)(ap += 8))}



{\ttfamily \+\_\+my\+\_\+va\+\_\+arg}用于将参数指针{\ttfamily ap}(argument pointer)指向栈中下一个类型为{\ttfamily t}的参数. 


\begin{DoxyParams}{参数}
{\em ap} & 参数指针 \\
\hline
{\em t} & 下一个参数的类型\\
\hline
\end{DoxyParams}
\begin{DoxyNote}{注解}
由于是{\ttfamily 64位}机器, 因此每次参数指针{\ttfamily ap}向后(高地址)增加8个字节
\end{DoxyNote}
\begin{DoxyRefDesc}{弃用}
\item[\mbox{\hyperlink{deprecated__deprecated000003}{弃用}}]自己写的{\ttfamily \+\_\+my\+\_\+va\+\_\+arg}只适用于{\ttfamily x86-\/32}, 因此已经弃用, 详细的原因参考文件的doc \end{DoxyRefDesc}
\mbox{\Hypertarget{stdarg_8h_af6468ba7e0b5727b681dd3905208872d}\label{stdarg_8h_af6468ba7e0b5727b681dd3905208872d}} 
\index{stdarg.h@{stdarg.h}!\_my\_va\_end@{\_my\_va\_end}}
\index{\_my\_va\_end@{\_my\_va\_end}!stdarg.h@{stdarg.h}}
\doxysubsubsection{\texorpdfstring{\_my\_va\_end}{\_my\_va\_end}}
{\footnotesize\ttfamily \#define \+\_\+my\+\_\+va\+\_\+end(\begin{DoxyParamCaption}\item[{}]{ap }\end{DoxyParamCaption})~ap = \mbox{\hyperlink{types_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{N\+U\+LL}}}



{\ttfamily \+\_\+my\+\_\+va\+\_\+end}用于清除参数指针{\ttfamily ap}(argument pointer) 


\begin{DoxyParams}{参数}
{\em ap} & 参数指针\\
\hline
\end{DoxyParams}
\begin{DoxyRefDesc}{弃用}
\item[\mbox{\hyperlink{deprecated__deprecated000004}{弃用}}]自己写的{\ttfamily \+\_\+my\+\_\+va\+\_\+end}只适用于{\ttfamily x86-\/32}, 因此已经弃用, 详细的原因参考文件的doc \end{DoxyRefDesc}
\mbox{\Hypertarget{stdarg_8h_ae641e06b00550c111ccb048aafe0fc4b}\label{stdarg_8h_ae641e06b00550c111ccb048aafe0fc4b}} 
\index{stdarg.h@{stdarg.h}!\_my\_va\_start@{\_my\_va\_start}}
\index{\_my\_va\_start@{\_my\_va\_start}!stdarg.h@{stdarg.h}}
\doxysubsubsection{\texorpdfstring{\_my\_va\_start}{\_my\_va\_start}}
{\footnotesize\ttfamily \#define \+\_\+my\+\_\+va\+\_\+start(\begin{DoxyParamCaption}\item[{}]{ap,  }\item[{}]{v }\end{DoxyParamCaption})~ap = (\mbox{\hyperlink{stdarg_8h_af53f622e3b6c080daeb167c1955d7ec1}{va\+\_\+list}}) \&v}



{\ttfamily \+\_\+my\+\_\+va\+\_\+start}用于将参数指针{\ttfamily ap}(argument pointer)指向第一个固定参数{\ttfamily v} 


\begin{DoxyParams}{参数}
{\em ap} & 参数指针 \\
\hline
{\em v} & 函数的第一个参数\\
\hline
\end{DoxyParams}
\begin{DoxyRefDesc}{弃用}
\item[\mbox{\hyperlink{deprecated__deprecated000002}{弃用}}]自己写的{\ttfamily \+\_\+my\+\_\+va\+\_\+list}只适用于{\ttfamily x86-\/32}, 因此已经弃用, 详细的原因参考文件的doc \end{DoxyRefDesc}
\mbox{\Hypertarget{stdarg_8h_afeb46f660b756eb161fb4aa8969925c7}\label{stdarg_8h_afeb46f660b756eb161fb4aa8969925c7}} 
\index{stdarg.h@{stdarg.h}!va\_arg@{va\_arg}}
\index{va\_arg@{va\_arg}!stdarg.h@{stdarg.h}}
\doxysubsubsection{\texorpdfstring{va\_arg}{va\_arg}}
{\footnotesize\ttfamily \#define va\+\_\+arg(\begin{DoxyParamCaption}\item[{}]{ap,  }\item[{}]{t }\end{DoxyParamCaption})~\+\_\+\+\_\+builtin\+\_\+va\+\_\+arg(ap, t)}



{\ttfamily va\+\_\+arg}用于将参数指针{\ttfamily ap}(argument pointer)指向栈中下一个类型为{\ttfamily t}的参数. 

\begin{DoxyNote}{注解}
关于类型t, 需要注意的是\+:
\begin{DoxyEnumerate}
\item 默认传入的最小单位是int, 因此char的调用方式为\+: {\ttfamily char varg\+\_\+char = (unsigned char) \mbox{\hyperlink{stdarg_8h_afeb46f660b756eb161fb4aa8969925c7}{va\+\_\+arg(ap, int)}}}
\end{DoxyEnumerate}

使用{\ttfamily G\+CC}内建的{\ttfamily \+\_\+\+\_\+builtin\+\_\+va\+\_\+arg}作为将变参列表指向下一个类型为{\ttfamily t}的参数 
\end{DoxyNote}
\mbox{\Hypertarget{stdarg_8h_acd9b3b9085ec072324c5fdac2b40304e}\label{stdarg_8h_acd9b3b9085ec072324c5fdac2b40304e}} 
\index{stdarg.h@{stdarg.h}!va\_end@{va\_end}}
\index{va\_end@{va\_end}!stdarg.h@{stdarg.h}}
\doxysubsubsection{\texorpdfstring{va\_end}{va\_end}}
{\footnotesize\ttfamily \#define va\+\_\+end(\begin{DoxyParamCaption}\item[{}]{ap }\end{DoxyParamCaption})~\+\_\+\+\_\+builtin\+\_\+va\+\_\+end(ap)}



{\ttfamily \+\_\+my\+\_\+va\+\_\+end}用于清除参数指针{\ttfamily ap}(argument pointer) 

\begin{DoxyNote}{注解}
使用{\ttfamily G\+CC}内建的{\ttfamily \+\_\+\+\_\+builtin\+\_\+va\+\_\+end}来清空变参列表 
\end{DoxyNote}
\mbox{\Hypertarget{stdarg_8h_aab2fdb7b45868b2622028377c750dad9}\label{stdarg_8h_aab2fdb7b45868b2622028377c750dad9}} 
\index{stdarg.h@{stdarg.h}!va\_start@{va\_start}}
\index{va\_start@{va\_start}!stdarg.h@{stdarg.h}}
\doxysubsubsection{\texorpdfstring{va\_start}{va\_start}}
{\footnotesize\ttfamily \#define va\+\_\+start(\begin{DoxyParamCaption}\item[{}]{ap,  }\item[{}]{v }\end{DoxyParamCaption})~\+\_\+\+\_\+builtin\+\_\+va\+\_\+start(ap, v)}



{\ttfamily va\+\_\+start}用于将参数指针{\ttfamily ap}(argument pointer)指向第一个固定参数{\ttfamily v} 

\begin{DoxyNote}{注解}
使用{\ttfamily G\+CC}内建的{\ttfamily \+\_\+\+\_\+builtin\+\_\+va\+\_\+start}作为将变参列表指向变参列表的的第一个参数 
\end{DoxyNote}


\doxysubsection{类型定义说明}
\mbox{\Hypertarget{stdarg_8h_a7606ba07f197c44b4185b4ce441e0d76}\label{stdarg_8h_a7606ba07f197c44b4185b4ce441e0d76}} 
\index{stdarg.h@{stdarg.h}!\_my\_va\_list@{\_my\_va\_list}}
\index{\_my\_va\_list@{\_my\_va\_list}!stdarg.h@{stdarg.h}}
\doxysubsubsection{\texorpdfstring{\_my\_va\_list}{\_my\_va\_list}}
{\footnotesize\ttfamily typedef char$\ast$ \mbox{\hyperlink{stdarg_8h_a7606ba07f197c44b4185b4ce441e0d76}{\+\_\+my\+\_\+va\+\_\+list}}}



变参宏以字节形式处理在栈中的函数参数, 因此变参列表{\ttfamily \+\_\+my\+\_\+va\+\_\+list}的本质就是字节 

\begin{DoxyRefDesc}{弃用}
\item[\mbox{\hyperlink{deprecated__deprecated000001}{弃用}}]自己写的{\ttfamily \+\_\+my\+\_\+va\+\_\+list}只适用于{\ttfamily x86-\/32}, 因此已经弃用, 详细的原因参考文件的doc \end{DoxyRefDesc}
\mbox{\Hypertarget{stdarg_8h_af53f622e3b6c080daeb167c1955d7ec1}\label{stdarg_8h_af53f622e3b6c080daeb167c1955d7ec1}} 
\index{stdarg.h@{stdarg.h}!va\_list@{va\_list}}
\index{va\_list@{va\_list}!stdarg.h@{stdarg.h}}
\doxysubsubsection{\texorpdfstring{va\_list}{va\_list}}
{\footnotesize\ttfamily typedef \+\_\+\+\_\+builtin\+\_\+va\+\_\+list \mbox{\hyperlink{stdarg_8h_af53f622e3b6c080daeb167c1955d7ec1}{va\+\_\+list}}}



变参列表类型, 本质就是一个指针, 因此也称为参数指针, 原理参考{\ttfamily G\+CC}编译器的传参原理 

\begin{DoxyNote}{注解}
使用{\ttfamily G\+CC}内建的{\ttfamily \+\_\+\+\_\+builtin\+\_\+va\+\_\+list}作为变参列表类型 
\end{DoxyNote}
